<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>eu.openanalytics</groupId>
	<artifactId>shinyproxy</artifactId>
	<version>1.0.2</version>
	<packaging>jar</packaging>

	<name>shinyproxy</name>
	<description>deploy Shiny apps in an enterprise context</description>

	<organization>
		<name>Open Analytics NV</name>
		<url>https://www.shinyproxy.io/</url>
	</organization>

	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>1.5.2.RELEASE</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<java.version>1.8</java.version>
	</properties>

	<repositories>
		<repository>
			<id>clojars</id>
			<url>http://clojars.org/repo/</url>
		</repository>
		<repository>
			<id>spring-milestones</id>
			<name>Spring Milestones</name>
			<url>https://repo.spring.io/libs-milestone</url>
			<snapshots>
				<enabled>false</enabled>
			</snapshots>
		</repository>
	</repositories>

	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-thymeleaf</artifactId>
		</dependency>
		<dependency>
			<groupId>org.thymeleaf.extras</groupId>
			<artifactId>thymeleaf-extras-springsecurity4</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
			<exclusions>
        		<exclusion>
            		<groupId>org.springframework.boot</groupId>
            		<artifactId>spring-boot-starter-tomcat</artifactId>
        		</exclusion>
    		</exclusions>
    	</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-websocket</artifactId>
		</dependency>
    	<dependency>
    		<groupId>org.springframework.boot</groupId>
    		<artifactId>spring-boot-starter-mail</artifactId>
    	</dependency>
 		<dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-messaging</artifactId>
        </dependency>
       	<dependency>
	        <groupId>org.springframework.ldap</groupId>
	        <artifactId>spring-ldap-core</artifactId>
	    </dependency>
    	<dependency>
    		<groupId>com.spotify</groupId>
    		<artifactId>docker-client</artifactId>
    		<version>8.6.2</version>
    	</dependency>
    	<dependency>
			<groupId>org.webjars</groupId>
			<artifactId>bootstrap</artifactId>
			<version>3.3.6</version>
		</dependency>
		<dependency>
			<groupId>org.webjars</groupId>
			<artifactId>jquery</artifactId>
			<version>2.2.2</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-jdbc</artifactId>
		</dependency>
    	<dependency>
        	<groupId>org.springframework.boot</groupId>
        	<artifactId>spring-boot-starter-security</artifactId>
    	</dependency>
    	<dependency>
        	<groupId>org.springframework.security</groupId>
        	<artifactId>spring-security-ldap</artifactId>
    	</dependency>
    	<dependency>
        	<groupId>org.springframework.security.oauth</groupId>
        	<artifactId>spring-security-oauth2</artifactId>
    	</dependency>
    	<dependency>
		    <groupId>org.springframework.social</groupId>
		    <artifactId>spring-social-core</artifactId>
		</dependency>
		<dependency>
		    <groupId>org.springframework.social</groupId>
		    <artifactId>spring-social-security</artifactId>
		</dependency>
		<dependency>
		    <groupId>org.springframework.social</groupId>
		    <artifactId>spring-social-web</artifactId>
		</dependency>
        <dependency>
            <groupId>org.springframework.social</groupId>
            <artifactId>spring-social-twitter</artifactId>
        </dependency>
		<dependency>
		  <groupId>org.springframework.social</groupId>
		  <artifactId>spring-social-facebook</artifactId>
		</dependency>
		<dependency>
		  <groupId>org.springframework.social</groupId>
		  <artifactId>spring-social-linkedin</artifactId>
		</dependency>
		<dependency>
		  <groupId>org.springframework.social</groupId>
		  <artifactId>spring-social-github</artifactId>
		  <version>1.0.0.M4</version>
		</dependency>
		<dependency>
		  <groupId>org.springframework.social</groupId>
		  <artifactId>spring-social-google</artifactId>
		  <version>1.0.0.RELEASE</version>
		</dependency>
		<dependency>
            <groupId>org.keycloak</groupId>
            <artifactId>keycloak-undertow-adapter</artifactId>
            <version>3.0.0.Final</version>
        </dependency>
        <dependency>
            <groupId>org.keycloak</groupId>
            <artifactId>keycloak-spring-security-adapter</artifactId>
            <version>3.0.0.Final</version>
        </dependency>
    	<dependency>
        	<groupId>org.apache.directory.server</groupId>
        	<artifactId>apacheds-server-jndi</artifactId>
        	<version>1.5.5</version>
    	</dependency>				 		
    	<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
    	<dependency>
    		<groupId>org.springframework.boot</groupId>
    		<artifactId>spring-boot-starter-undertow</artifactId>
    	</dependency>
    	<dependency>
    		<groupId>io.undertow</groupId>
    		<artifactId>undertow-core</artifactId>
    	</dependency>
    	<dependency>
    		<groupId>io.undertow</groupId>
    		<artifactId>undertow-servlet</artifactId>
    	</dependency>
    	<dependency>
    		<groupId>io.undertow</groupId>
    		<artifactId>undertow-websockets-jsr</artifactId>
    	</dependency>
    	<dependency>
    		<groupId>monetdb</groupId>
    		<artifactId>monetdb-jdbc</artifactId>
    		<version>2.24</version>
    	</dependency>
    	<dependency>
    		<groupId>com.h2database</groupId>
    		<artifactId>h2</artifactId>
    	</dependency>
		<dependency>
			<groupId>io.fabric8</groupId>
			<artifactId>kubernetes-client</artifactId>
			<version>3.0.3</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<executable>true</executable>
				</configuration>
			</plugin>

			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>rpm-maven-plugin</artifactId>
				<version>2.1.5</version>
<!-- 				<executions>
        	<execution>
		        <id>generate-rpm</id>
		        <goals>
			       <goal>attached-rpm</goal>
		        </goals>
	        </execution>
        </executions> -->
				<configuration>
					<license>(c) Copyright Open Analytics NV, 2016-2017 - Apache License 2.0</license>
					<release>1.el7</release>
					<group>Development/Tools</group>
					<packager>Open Analytics</packager>
					<defineStatements>
						<defineStatement>_unpackaged_files_terminate_build 0</defineStatement>
					</defineStatements>
					<mappings>

						<mapping>
							<directory>/opt/shinyproxy</directory>
							<filemode>755</filemode>
							<username>shinyproxy</username>
							<groupname>shinyproxy</groupname>
						</mapping>

						<mapping>
							<directory>/opt/shinyproxy</directory>
							<filemode>755</filemode>
							<username>shinyproxy</username>
							<groupname>shinyproxy</groupname>
							<artifact />
						</mapping>

						<mapping>
							<directory>/opt/shinyproxy</directory>
							<sources>
								<softlinkSource>
									<destination>shinyproxy.jar</destination>
									<location>shinyproxy-${project.version}.jar</location>
								</softlinkSource>
							</sources>
						</mapping>

						<mapping>
							<directory>/opt/shinyproxy</directory>
							<filemode>755</filemode>
							<username>shinyproxy</username>
							<groupname>shinyproxy</groupname>
							<sources>
								<source>
									<location>src/deb/shinyproxy.service</location>
								</source>
								<source>
									<location>src/deb/shinyproxy.conf</location>
								</source>
								<source>
									<location>src/main/resources/application-demo.yml</location>
								</source>
							</sources>
						</mapping>
					  
					  <mapping>
              <directory>/etc/shinyproxy</directory>
              <filemode>755</filemode>
              <username>shinyproxy</username>
              <groupname>shinyproxy</groupname>
            </mapping>

					</mappings>
					<requires>
						<require>java</require>
					</requires>
					<preinstallScriptlet>
            <scriptFile>src/deb/control/preinst</scriptFile>
            <fileEncoding>utf-8</fileEncoding>
          </preinstallScriptlet>
					<postinstallScriptlet>
						<scriptFile>src/deb/control/postinst</scriptFile>
						<fileEncoding>utf-8</fileEncoding>
					</postinstallScriptlet>
					<preremoveScriptlet>
						<scriptFile>src/deb/control/prerm</scriptFile>
						<fileEncoding>utf-8</fileEncoding>
					</preremoveScriptlet>
					<postremoveScriptlet>
						<scriptFile>src/deb/control/postrm</scriptFile>
						<fileEncoding>utf-8</fileEncoding>
					</postremoveScriptlet>
				</configuration>
			</plugin>

			<plugin>
				<artifactId>jdeb</artifactId>
				<groupId>org.vafer</groupId>
				<version>1.5</version>
<!--        <executions>
          <execution>
            <phase>package</phase>
            <goals>
              <goal>jdeb</goal>
            </goals>
          </execution>
        </executions>-->
				<configuration>
					<verbose>true</verbose>
					<controlDir>${basedir}/src/deb/control</controlDir>
					<dataSet>
						<data>
							<src>${project.build.directory}/${project.build.finalName}.jar</src>
							<type>file</type>
							<mapper>
								<type>perm</type>
								<prefix>/opt/${project.artifactId}</prefix>
								<user>shinyproxy</user>
								<group>shinyproxy</group>
							</mapper>
						</data>
						<data>
							<type>link</type>
							<symlink>true</symlink>
							<linkName>/opt/${project.artifactId}/${project.artifactId}.jar</linkName>
							<linkTarget>/opt/${project.artifactId}/${project.build.finalName}.jar</linkTarget>
						</data>
						<data>
							<src>${basedir}/src/deb/shinyproxy.service</src>
							<type>file</type>
							<mapper>
								<type>perm</type>
								<prefix>/opt/${project.artifactId}</prefix>
								<user>shinyproxy</user>
                <group>shinyproxy</group>
							</mapper>
						</data>
						<data>
							<src>${basedir}/src/deb/shinyproxy.conf</src>
							<type>file</type>
							<mapper>
								<type>perm</type>
								<prefix>/opt/${project.artifactId}</prefix>
								<user>shinyproxy</user>
                <group>shinyproxy</group>
							</mapper>
						</data>
						<data>
							<src>${basedir}/src/main/resources/application-demo.yml</src>
							<type>file</type>
							<mapper>
								<type>perm</type>
								<prefix>/opt/${project.artifactId}</prefix>
								<user>shinyproxy</user>
                <group>shinyproxy</group>
							</mapper>
						</data>
						<data>
							<type>template</type>
							<paths>
								<path>etc/${project.artifactId}</path>
							</paths>
							<mapper>
                <type>perm</type>
                <user>shinyproxy</user>
                <group>shinyproxy</group>
              </mapper>
						</data>
					</dataSet>
				</configuration>
			</plugin>

			<plugin>
				<groupId>com.mycila.maven-license-plugin</groupId>
				<artifactId>maven-license-plugin</artifactId>
				<version>1.9.0</version>
				<configuration>
					<header>LICENSE_HEADER</header>
					<aggregate>true</aggregate>
					<strictCheck>true</strictCheck>
					<excludes>
						<exclude>*.log</exclude>
						<exclude>mvnw.cmd</exclude>
						<exclude>mvnw</exclude>
						<exclude>**/*.properties</exclude>
						<exclude>**/*.yml</exclude>
						<exclude>LICENSE</exclude>
						<exclude>LICENSE_HEADER</exclude>
						<exclude>README.md</exclude>
						<exclude>**/*.json</exclude>
						<exclude>.gitignore</exclude>
						<exclude>src/deb/**</exclude>
					</excludes>
				</configuration>
				<executions>
					<!--<execution>
						<id>generate-copyright-headers</id>
						<phase>process-sources</phase>
						<goals>
							<goal>format</goal>
						</goals>
					</execution>-->
					<execution>
						<id>check-copyright-headers</id>
						<phase>package</phase>
						<goals>
							<goal>check</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>net.nicoulaj.maven.plugins</groupId>
				<artifactId>checksum-maven-plugin</artifactId>
				<version>1.5</version>
				<executions>
					<execution>
						<goals>
							<goal>artifacts</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
          		   <algorithms>
            	       <algorithm>SHA-256</algorithm>	   
                       <algorithm>MD5</algorithm>
                   </algorithms>
        		</configuration>
			</plugin>
		</plugins>
	</build>
	
</project>
